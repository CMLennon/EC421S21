<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Instrumental Variables</title>
    <meta charset="utf-8" />
    <meta name="author" content="Connor Lennon" />
    <meta name="date" content="2021-06-03" />
    <script src="IV_files/header-attrs-2.8/header-attrs.js"></script>
    <link href="IV_files/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="IV_files/remark-css-0.0.1/metropolis.css" rel="stylesheet" />
    <link href="IV_files/remark-css-0.0.1/metropolis-fonts.css" rel="stylesheet" />
    <script src="IV_files/htmlwidgets-1.5.3/htmlwidgets.js"></script>
    <script src="IV_files/jquery-3.5.1/jquery.min.js"></script>
    <link href="IV_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="IV_files/datatables-binding-0.18/datatables.js"></script>
    <link href="IV_files/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="IV_files/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="IV_files/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
    <link href="IV_files/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
    <script src="IV_files/crosstalk-1.1.1/js/crosstalk.min.js"></script>
    <link rel="stylesheet" href="my-css.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Instrumental Variables
## EC 421, Set 12
### Connor Lennon
### 03 June 2021

---

class: inverse, middle



# Prologue

---
name: schedule

# Schedule

## Last Time

Causality

## Today

- Review: Causality
- New: Instrumental variables

## Upcoming

The end?
---
layout: false
class: inverse, middle
# Causality
## Review
---
layout: true
# Causality
## Review
---
name: causality_review

In our last few weeks, we returned more robustly to the concept of .hi[causality].

--

We worked through the *Rubin causal model*, in which we defined

- `\(\color{#e64173}{y_{1i}:}\)` the outcome for individual `\(i\)` if she had received treatment

--
- `\(\color{#6A5ACD}{y_{0i}:}\)` the outcome for individual `\(i\)` if she had not received treatment

--

and we referred to individuals who did not receive treatment as *control*.

--

***If*** we were able to know both `\(\color{#e64173}{y_{1i}}\)` ***and*** `\(\color{#6A5ACD}{y_{0i}}\)`, we could calculate the causal effect of treatment for individual `\(i\)`, _i.e._,

--

$$
`\begin{align}
  \tau_i = \color{#e64173}{y_{1i}} - \color{#6A5ACD}{y_{0i}}
\end{align}`
$$

---

.hi-slate[Fundamental problem of causal inference:]
&lt;br&gt;We cannot simultaneously know `\(\color{#e64173}{y_{1i}}\)` and `\(\color{#6A5ACD}{y_{0i}}\)`.

--

Either we observe individual `\(i\)` in the treatment group, _i.e._,
$$
`\begin{align}
  \tau_i = \color{#e64173}{y_{1i}} - \color{#6A5ACD}{?}
\end{align}`
$$

--

or we observe `\(i\)` in the control group, _i.e._,
$$
`\begin{align}
  \tau_i = \color{#e64173}{?} - \color{#6A5ACD}{y_{0i}}
\end{align}`
$$

--

but never both at the same time.
---

If we want to know `\(\tau_i\)` (or at least `\(\overline{\tau}\)`), what can we do?

--

**Idea:** Estimate the .hi-slate[average treatment effect] as the difference between the average outcomes in the treatment group and the control group, _i.e._,

$$
`\begin{align}
  \color{#e64173}{\mathop{Avg}\left( y_i\mid D_i = 1 \right)} - \color{#6A5ACD}{\mathop{Avg}\left( y_i\mid D_i =0 \right)}
\end{align}`
$$
where `\(D_i=1\)` if `\(i\)` received treatment, and `\(D_i=0\)` if `\(i\)` is in the control group.

---

**Result:** We showed that even when the treatment effect is constant (meaning `\(\tau_i=\tau\)` for all `\(i\)`),
$$
`\begin{align}
  &amp;\color{#e64173}{\mathop{Avg}\left( y_i\mid D_i = 1 \right)} - \color{#6A5ACD}{\mathop{Avg}\left( y_i\mid D_i =0 \right)} \\
  &amp;\quad\quad = \tau + \underbrace{\color{#e64173}{\mathop{Avg}\left(\color{#6A5ACD}{y_{0,i}} \mid D_i = 1 \right)} - \color{#6A5ACD}{\mathop{Avg}\left( y_{0,i}\mid D_i =0 \right)}}_{\color{#FFA500}{\text{Selection bias}}}
\end{align}`
$$

which says that the difference in the groups' means will give us a **biased estimate** for the causal effect of treatment .hi-orange[if we have selection bias.]
---

**Q:** What is this .hi-orange[selection bias]?

--

**A:** **(Informal)** We have selection bias when our control group doesn't offer a good comparison for our treatment group.

--

Specifically, the control group doesn't give us a good .hi-orange[counterfactual] for .orange[what our treatment group would have looked like if the members had not received treatment.]
--
 Basically, the groups are different.

--

**A:** **(Formal)** The .pink[average *untreated* outcome for a member of our **treatment group**] (which we cannot observe) differs from the .purple[average *untreated* outcome for a member of our **control group**], _i.e._,
$$
`\begin{align}
  \color{#e64173}{\mathop{Avg}\left(\color{#6A5ACD}{y_{0,i}} \mid D_i = 1 \right)} - \color{#6A5ACD}{\mathop{Avg}\left( y_{0,i}\mid D_i =0 \right)}
\end{align}`
$$
---

What about using .def[SCM] or .def[DAG]?

--

We learned that a SCM is a DAG with a collection of random variable .orange[nodes] and causal effect .purple[edges].

--

We also learned that an 'experiment' in a SCM is a .hi[mutilation] of the graph... 

- delete all incoming causal edges to our 'intervened on' node.

We can think of this like our 'omitted variable bias' dag.

---

.ex[Example] Selection Bias



&lt;img src="IV_files/figure-html/dag-ex-ovb-1.svg" style="display: block; margin: auto;" /&gt;

Selection Bias in a DAG

---

.ex[Example] If the Experiment went well...



&lt;img src="IV_files/figure-html/dag-ex-exp-1.svg" style="display: block; margin: auto;" /&gt;

---

.hi-slate[Practical problem:] Selection bias is unfortunately, difficult to observe, so often we cannot simply condition on `Sel`. In Rubic-Neyman...

$$
`\begin{align}
  \underbrace{\color{#e64173}{\mathop{Avg}\left(\color{#6A5ACD}{y_{0,i}} \mid D_i = 1 \right)}}_{\color{#e64173}{\text{Unobservable}}} - \color{#6A5ACD}{\mathop{Avg}\left( y_{0,i}\mid D_i =0 \right)}
\end{align}`
$$

(back to the *fundamental problem of causal inference*)

--

.hi-slate[Bigger problem:] If selection bias is present, our estimate for `\(\tau\)` is biased, preventing us from understanding the causal effect of treatment.

--

Sounds a bit like omitted-variable bias, right?
--
 Our .pink[treatment] variable is correlated with something that makes the two groups different.
---

**Example:** Imagine we have two people—Al and Bri—and a single binary treatment, college. We interested in the effect of college on earnings.

.pull-left[.center[
.pink[Earn.sub[1,Al]] = .pink[$60K]
&lt;br&gt;.purple[Earn.sub[0,Al]] = .purple[$30K]
]]
.pull-right[
.pink[Earn.sub[1,Bri]] = .pink[$140K]
&lt;br&gt;.purple[Earn.sub[0,Bri]] = .purple[$110K]
]

--

They both have the same treatment effect (return to college)
--
&lt;br&gt; `\(\quad\quad\tau\)`.sub[Al] = .pink[Earn.sub[1,Al]] - .purple[Earn.sub[0,Al]] = .pink[$60K] - .purple[$30K] = $30K
--
&lt;br&gt; `\(\quad\quad\tau\)`.sub[Bri] = .pink[Earn.sub[1,Bri]] - .purple[Earn.sub[0,Bri]] = .pink[$140K] - .purple[$100K] = $30K

--

but any real-world estimate would have serious selection issues since .purple[Earn.sub[0,Al]] ≠ .purple[Earn.sub[0,Bri].]
---
count: false

**Example:** Imagine we have two people—Al and Bri—and a single binary treatment, college. We interested in the effect of college on earnings.

.pull-left[.center[
.pink[Earn.sub[1,Al]] = .pink[$60K]
&lt;br&gt;.purple[Earn.sub[0,Al]] = .purple[$30K]
]]
.pull-right[
.pink[Earn.sub[1,Bri]] = .pink[$140K]
&lt;br&gt;.purple[Earn.sub[0,Bri]] = .purple[$110K]
]

The selection bias...

--

If Bri attended college (D.sub[Bri]=1) and Al did not (D.sub[Al]=0):
&lt;br&gt;
`\(\quad\quad\hat{\tau}\)` = .pink[Earn.sub[1,Bri]] - .purple[Earn.sub[0,Al]] = .pink[$140K] - .purple[$30K] = $110K

--

If Al attended college (D.sub[Al]=1) and Bri did not (D.sub[Bri]=0):
&lt;br&gt;
`\(\quad\quad\hat{\tau}\)` = .pink[Earn.sub[1,Al]] - .purple[Earn.sub[0,Bri]] = .pink[$60K] - .purple[$110K] = -$50K



---

We have (at least) two problems...

1. Selection bias is difficult to observe

2. If selection bias is present, our estimate for `\(\tau\)` is biased, preventing us from understanding the causal effect of treatment.

--

.hi-slate[Solution:] Eliminate/minimize selection bias.

--

- .hi-slate[Option 1:] .hi-pink[Distribute treatment] in a way such that the treatment and control groups are essentially identical
--
 (experiments).

--

- .hi-slate[Option 2:] .hi-purple[Build a control] group that *matches* the treatment group
--
 &lt;br&gt;(life with observational data).
---
layout: true
# Instrumental variables
---
class: inverse, middle
---
name: intro

## Intro

.hi[Instrumental variables (IV)] is one route econometricians often take toward estimating the causal effect of a treatment/program.

--

*Recall:* .hi-orange[Selection bias] means our .pink[treatment] and .purple[control] groups differ on some unobserved/omitted dimension. (.hi-slate[Endogeneity])

--

.hi-pink[Instrumental variables] attempts to separate out

- the .hi-slate[exogenous] part of `\(x\)`, which gives us unbiased estimates
- the .hi-slate[endogenous] part of `\(x\)`, which biases our results

--

If we use only the exogenous (*good*) variation in `\(x\)`, then we can avoid selection bias/omitted-variable bias.
---
class:clear
.ex[In a **DAG**]



&lt;img src="IV_files/figure-html/dag-ex-iv-1.svg" style="display: block; margin: auto;" /&gt;
.hi[Works].

--

What if selection bias goes .purple[the other way?]

---

class:clear
.ex[In a **DAG**]



&lt;img src="IV_files/figure-html/dag-ex-iv-2-1.svg" style="display: block; margin: auto;" /&gt;
.hi[Can Work...] IF we make pretty specific assumptions about `IV`

--

Let's lay those out, shall we?

---

## Introductory example

*Example:* If we want to estimate the effect of veteran status on earnings,
$$
`\begin{align}
  \text{Earnings}_i = \beta_0 + \beta_1 \text{Veteran}_i + u_i \tag{1}
\end{align}`
$$

--

We would love to calculate `\(\color{#e64173}{\text{Earnings}_{1i}} - \color{#6A5ACD}{\text{Earnings}_{0i}}\)`, but we can't.

--

And OLS will likely be biased for `\((1)\)` due to selection/omitted-variable bias.

---

## Introductory example

Imagine that we can split veteran status into an exogenous part and an endogenous part...

--

$$
`\begin{align}
  \text{Earnings}_i
  &amp;= \beta_0 + \beta_1 \text{Veteran}_i + u_i \tag{1} \\
  &amp;= \beta_0 + \beta_1 \left(\text{Veteran}_i^{\text{Exog.}} + \text{Veteran}_i^{\text{Endog.}}\right) + u_i \\
  &amp;= \beta_0 + \beta_1 \text{Veteran}_i^{\text{Exog.}} + \underbrace{\beta_1 \text{Veteran}_i^{\text{Endog.}} + u_i}_{w_i} \\
  &amp;= \beta_0 + \beta_1 \text{Veteran}_i^{\text{Exog.}} + w_i
\end{align}`
$$

--

We could use this exogenous variation in veteran status to consistently estimate `\(\beta_1\)`.

--

**Q:** What would exogenous variation in veteran status mean?
---

## Introductory example

**Q:** What would exogenous variation in veteran status mean?

--

**A.sub[1]:** Choices to enlist in the military that are essentially random—or at least uncorrelated with omitted variables and the disturbance.

--

**A.sub[2]:** .hi-orange[No selection bias:]
$$
`\begin{align}
  \color{#e64173}{\mathop{Avg}\left(\text{Earnings}_{0i}\mid\text{Veteran}_i = 1\right)} - \color{#6A5ACD}{\mathop{Avg}\left( \text{Earnings}_{0i} \mid \text{Veteran}_i = 0 \right)} = 0
\end{align}`
$$

---
name: instruments

## Instruments

**Q:** How do we isolate this *exogenous variation* in our explanatory variable?
--
&lt;br&gt;**A:** Find an instrument (an instrumental variable).

--

**Q:** What's an instrument?
--
&lt;br&gt;**A:** An .hi-pink[instrument] is a variable that is

1. **correlated** with the **explanatory variable** of interest (.hi[relevant]),
2. **uncorrelated** with the **disturbance** (.hi[exogenous]).

---

## Instruments

&gt;**Q:** What's an instrument?
&gt;&lt;br&gt;**A:** An .hi-pink[instrument] is a variable that is
&gt;
&gt;1. **correlated** with the **explanatory variable** of interest (.hi[relevant]),
&gt;2. **uncorrelated** with the **disturbance** (.hi[exogenous]).
--

So if we want an instrument `\(z_i\)` for endogenous veteran status in
$$
`\begin{align}
  \text{Earnings}_i = \beta_0 + \beta_1 \text{Veteran}_i + u_i
\end{align}`
$$

1. .hi[Relevant:] `\(\mathop{\text{Cov}} \left( \text{Veteran}_i,\, z_i \right) \neq 0\)`
2. .hi[Exogenous:] `\(\mathop{\text{Cov}} \left( z_i,\, u_i \right) = 0\)`
---
name: relevant

## Instruments: Relevance

.hi[Relevance:] We need the instrument to cause a change in (correlate with) our endogenous explanatory variable.

We can actually test this requirement using regression and a *t* test.

--

***Example:*** For the .pink[veteran status], consider three potential instruments:

.pull-left[1\. Social security number&lt;br&gt;.white[blank]]

--

.pull-right[.hi-slate[Probably not relevant]&lt;br&gt;uncorrelated with military service]

--

.pull-left[2\. Physical fitness&lt;br&gt;.white[blank]]

--

.pull-right[.hi-pink[Potentially relevant]&lt;br&gt;service may correlate with fitness]

--

.pull-left[3\. Vietnam War draft]

--

.pull-right[.hi-pink[Relevant]&lt;br&gt;being draw led to service]

---
name: exogenous

## Instruments: Exogeneity

.hi[Exogeneity:] The instrument to be independent of omitted factors that affect our outcome variable—as good as randomly assigned.

`\(z_i\)` must be uncorrelated with our disturbance `\(u_i\)`. .hi[Not testable.]

--

***Example:*** For the .pink[veteran status], consider three potential instruments:

.pull-left[1\. Social security number&lt;br&gt;.white[blank]]

--

.pull-right[.hi-pink[Exogenous]&lt;br&gt;Indep. of other factors of service]

--

.pull-left[2\. Physical fitness&lt;br&gt;.white[blank]]

--

.pull-right[.hi-slate[Not exogenous]&lt;br&gt;fitness correlates with many things]

--

.pull-left[3\. Vietnam War draft]

--

.pull-right[.hi-pink[Exogenous]&lt;br&gt;the lottery was random]

---

## Instrumental review

Let's recap...

- Our instrument must be .hi[correlated with our endogenous variable].

- Our instrument must be .hi[uncorrelated with any other variable that affects the outcome].

--

.hi-slate[In other words:]
&lt;br&gt;The instrument only affects our outcome through the endogenous variable.
---

## Back to our example

For .pink[veteran status] we considered three potential instruments:

--

.pull-left[1\. Social security number&lt;br&gt;.white[blank]&lt;br&gt;.white[blank]]

.pull-right[.hi-slate[Not relevant]&lt;br&gt;.hi-pink[Exogenous]&lt;br&gt;.white[blank]]

--

.pull-left[2\. Physical fitness&lt;br&gt;.white[blank]&lt;br&gt;.white[blank]]

.pull-right[.hi-pink[Probably relevant]&lt;br&gt;.hi-slate[Not exogenous]&lt;br&gt;.white[blank]]

--

.pull-left[3\. Vietnam War draft&lt;br&gt;.white[blank]&lt;br&gt;.white[blank]]

.pull-right[.hi-pink[Relevant]&lt;br&gt;.hi-pink[Exogenous]&lt;br&gt;.white[blank]]

--

Thus, only the Vietnam War's draft lottery appears to be a .hi[*valid* instrument].

---
layout: false
class: clear, middle

If we have a *valid* instrument (_e.g._, the draft lottery), how do we use it?
---
layout: true
# Instrumental variables
## Estimation
---
name: iv_estimation

*Recall:* We want to estimate the effect of veteran status on earnings.
$$
`\begin{align}
  \color{#FFA500}{\text{Earnings}_i} = \beta_0 + \beta_1 \color{#6A5ACD}{\text{Veteran}_i} + u_i
\end{align}`
$$

--

Let's consider two related effects:

--

1. The effect of the .hi-pink[instrument] on the .hi-purple[endogenous variable], _e.g._,
$$
`\begin{align}
  \color{#6A5ACD}{\text{Veteran}_i} = \gamma_0 + \gamma_1 \color{#e64173}{\text{Draft}_i} + v_i
\end{align}`
$$

--
1. The effect of the .hi-pink[instrument] on the .hi-orange[outcome variable], _e.g._,
$$
`\begin{align}
  \color{#FFA500}{\text{Earnings}_i} = \pi_0 + \pi_1 \color{#e64173}{\text{Draft}_i} + w_i
\end{align}`
$$
---

*Recall:* We want to estimate the effect of veteran status on earnings.
$$
`\begin{align}
  \color{#FFA500}{\text{Earnings}_i} = \beta_0 + \beta_1 \color{#6A5ACD}{\text{Veteran}_i} + u_i
\end{align}`
$$
and we know that the draft affected veteran status.

--

.center[
.hi-pink[Draft] ⟶ .hi-purple[Veteran status] ⟶ .hi-orange[Earnings]
]

Using our assumptions on independence and exogeneity:

(Effect of .hi-pink[the draft] on .hi-orange[earnings]) =
&lt;br&gt;  (Effect of .hi-pink[the draft] on .hi-purple[veteran status])×
&lt;br&gt;  (Effect of .hi-purple[veteran status] on .hi-orange[earnings])
---

We just wrote out an expression for the effect of .hi-pink[the draft] on .hi-orange[earnings], _i.e._,

(Effect of .hi-pink[the draft] on .hi-orange[earnings]) =
&lt;br&gt;  (Effect of .hi-pink[the draft] on .hi-purple[veteran status])×
&lt;br&gt;  (Effect of .hi-purple[veteran status] on .hi-orange[earnings])

--

but we want to know the effect of .hi-purple[veteran status] on .hi-orange[earnings].
--
 Rearrange!

--

(Effect of .hi-purple[veteran status] on .hi-orange[earnings]) =
&lt;br&gt;  .top[(Effect of .hi-pink[the draft] on .hi-orange[earnings])]
&lt;br&gt;  .bottom[(Effect of .hi-pink[the draft] on .hi-purple[veteran status])]

--

Our .hi-pink[instrument] consistently estimates both parts of this fraction!
---
layout: true
# Instrumental variables
## Estimation: Bring it all together
---

By estimating two regressions involving our .hi-pink[instrument],

1. The effect of the .hi-pink[instrument] on the .hi-purple[endogenous variable], _e.g._,
$$
`\begin{align}
  \color{#6A5ACD}{\text{Veteran}_i} = \gamma_0 + \gamma_1 \color{#e64173}{\text{Draft}_i} + v_i
\end{align}`
$$

1. The effect of the .hi-pink[instrument] on the .hi-orange[outcome variable], _e.g._,
$$
`\begin{align}
  \color{#FFA500}{\text{Earnings}_i} = \pi_0 + \pi_1 \color{#e64173}{\text{Draft}_i} + w_i
\end{align}`
$$

--

we can estimate our desired effect:

--

(Effect of .hi-purple[veteran status] on .hi-orange[earnings]) =
&lt;br&gt;  .top[(Effect of .hi-pink[the draft] on .hi-orange[earnings])]
&lt;br&gt;  .bottom[(Effect of .hi-pink[the draft] on .hi-purple[veteran status])]

---
count: false

By estimating two regressions involving our .hi-pink[instrument],

1. The effect of the .hi-pink[instrument] on the .hi-purple[endogenous variable], _e.g._,
$$
`\begin{align}
  \color{#6A5ACD}{\text{Veteran}_i} = \gamma_0 + \gamma_1 \color{#e64173}{\text{Draft}_i} + v_i
\end{align}`
$$

1. The effect of the .hi-pink[instrument] on the .hi-orange[outcome variable], _e.g._,
$$
`\begin{align}
  \color{#FFA500}{\text{Earnings}_i} = \pi_0 + \pi_1 \color{#e64173}{\text{Draft}_i} + w_i
\end{align}`
$$

we can estimate our desired effect:

(Effect of .hi-purple[veteran status] on .hi-orange[earnings]) = `\(\dfrac{\pi_1}{\gamma_1}\)`
---

So with instrumental variables, we estimate `\(\beta_1\)` using
$$
`\begin{align}
  \hat{\beta}_1^\text{IV} = \dfrac{\hat{\pi}_1}{\hat{\gamma}_1}
\end{align}`
$$
where `\(\hat{\pi}_1\)` and `\(\hat{\gamma}_1\)` come from the two equations we just discussed.

--

**Q:** Can we trust `\(\hat{\beta}_1^\text{IV}\)`?
--
&lt;br&gt;**A:** Yes... **if we have a valid instrument.**

--
$$
`\begin{align}
  \mathop{\text{plim}}\left( \hat{\beta}_1^\text{IV} \right) = \beta_1 + \dfrac{\mathop{\text{Cov}} \left( \color{#e64173}{\text{Instrument}},\, u \right)}{\mathop{\text{Cov}} \left( \color{#e64173}{\text{Instrument}},\, \color{#6A5ACD}{\text{Endog. variable}} \right)}
\end{align}`
$$
--
which equals `\(\beta_1\)` as long as our instrument is .hi-pink[exogenous] (numerator) and .hi-purple[relevant] (denominator).
---
layout: false
class:clear
name: venn

&lt;img src="IV_files/figure-html/venn_iv-1.svg" style="display: block; margin: auto;" /&gt;
---
class: clear
count: false

&lt;img src="IV_files/figure-html/venn_iv_endog-1.svg" style="display: block; margin: auto;" /&gt;
---
class: clear
count: false

&lt;img src="IV_files/figure-html/venn_iv_irrelevant-1.svg" style="display: block; margin: auto;" /&gt;
---
class: clear
count: false

&lt;img src="IV_files/figure-html/venn_iv_endog2-1.svg" style="display: block; margin: auto;" /&gt;
---
layout: false
# Venn diagram explanation

In these figures (Venn diagrams)

- Each circle illustrates a variable.
- Overlap gives the share of correlatation between two variables.
- Dotted borders denote *omitted* variables.

Take-aways

- Figure 1: .hi-pink[Valid instrument] (relevant; exogenous)
- Figure 2: .hi-slate[Invalid instrument] (relevant; not exogenous)
- Figure 3: .hi-slate[Invalid instrument] (not relevant; not exogenous)
- Figure 4: .hi-slate[Invalid instrument] (relevant; not exogenous)

---
layout: false
class: clear, middle

Let's work an example in .mono[R].
---
layout: true
# Instrumental variables
## Example in .mono[R]
---
name: r_example

Back to our age-old battle to estimate the returns to education.

<div id="htmlwidget-7a212abbde15e47c6e0d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-7a212abbde15e47c6e0d">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375","376","377","378","379","380","381","382","383","384","385","386","387","388","389","390","391","392","393","394","395","396","397","398","399","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","418","419","420","421","422","423","424","425","426","427","428","429","430","431","432","433","434","435","436","437","438","439","440","441","442","443","444","445","446","447","448","449","450","451","452","453","454","455","456","457","458","459","460","461","462","463","464","465","466","467","468","469","470","471","472","473","474","475","476","477","478","479","480","481","482","483","484","485","486","487","488","489","490","491","492","493","494","495","496","497","498","499","500","501","502","503","504","505","506","507","508","509","510","511","512","513","514","515","516","517","518","519","520","521","522","523","524","525","526","527","528","529","530","531","532","533","534","535","536","537","538","539","540","541","542","543","544","545","546","547","548","549","550","551","552","553","554","555","556","557","558","559","560","561","562","563","564","565","566","567","568","569","570","571","572","573","574","575","576","577","578","579","580","581","582","583","584","585","586","587","588","589","590","591","592","593","594","595","596","597","598","599","600","601","602","603","604","605","606","607","608","609","610","611","612","613","614","615","616","617","618","619","620","621","622","623","624","625","626","627","628","629","630","631","632","633","634","635","636","637","638","639","640","641","642","643","644","645","646","647","648","649","650","651","652","653","654","655","656","657","658","659","660","661","662","663","664","665","666","667","668","669","670","671","672","673","674","675","676","677","678","679","680","681","682","683","684","685","686","687","688","689","690","691","692","693","694","695","696","697","698","699","700","701","702","703","704","705","706","707","708","709","710","711","712","713","714","715","716","717","718","719","720","721","722"],[769,808,825,650,562,600,1154,1000,930,900,1318,1792,958,1360,850,1615,873,2137,1053,1602,1188,800,1417,635,1424,2668,666,1779,1572,1274,714,1081,692,1318,1027,1748,770,1154,808,1100,1154,1749,1000,769,875,1375,1452,800,1748,1151,840,619,442,1643,1455,2310,1682,1235,855,1072,1000,675,1100,996,1200,1694,686,832,579,672,2500,1076,750,1186,833,650,1122,865,808,1299,903,900,625,962,1539,1110,1282,770,1000,750,654,601,600,433,1188,1225,1151,865,1031,1049,1000,1105,1924,1346,809,1495,1346,1200,500,1325,900,800,1034,980,884,480,923,513,1105,2771,779,950,1394,1495,650,670,1126,450,2404,757,1250,1025,1100,714,1318,1411,2162,1140,578,750,1000,951,635,1250,400,577,590,923,1250,1100,1130,652,618,962,529,817,840,866,2404,1126,1160,1778,1903,971,525,525,500,550,500,727,865,1081,1304,575,623,515,1273,990,600,1160,500,795,1250,1014,1346,1250,1452,1391,821,794,520,1730,1924,1155,2162,1500,826,937,1031,1272,1136,1339,1063,935,808,375,1155,622,841,769,1924,1058,417,1202,1154,1202,711,1202,850,1000,490,1000,865,1375,1586,898,906,952,571,445,289,1444,962,1075,1250,800,1050,654,781,1038,1924,1202,905,890,817,812,577,756,1155,1025,1001,1230,714,2067,912,600,711,1151,1000,400,1175,1202,1442,781,750,841,700,1346,800,1105,475,762,962,721,800,658,1270,824,1442,1400,1038,668,1100,1000,1111,962,729,1010,600,596,670,793,1442,670,876,841,975,1223,910,533,750,1206,745,900,1170,540,615,909,769,984,879,1027,465,641,1035,1212,950,1250,586,693,562,375,654,1111,1368,1282,1346,854,888,583,1260,947,1850,1575,758,1442,1126,1000,500,1200,1920,684,774,233,975,1366,2137,700,1161,729,750,1111,1200,1541,1154,310,610,1749,1000,350,765,790,818,477,938,2099,350,940,1058,1000,318,556,958,995,1600,606,511,1411,1346,1522,1075,1200,1377,874,625,1250,1082,693,727,615,884,698,800,812,1000,549,923,721,815,1100,1058,962,433,1417,1000,500,800,750,550,723,1039,200,575,850,1270,350,1463,802,642,751,488,1400,940,675,346,1442,560,550,684,417,472,1679,1039,760,1154,1602,1442,865,770,1000,1329,1682,577,685,577,1040,1250,480,1000,988,478,440,1550,960,1000,625,1346,1201,1122,507,462,1634,1282,556,1200,855,1053,1000,1602,508,1500,1682,750,843,650,2137,761,769,2500,1212,577,390,1500,583,1442,1333,1500,973,2162,797,400,1015,1744,630,445,660,377,1122,453,1386,1539,1154,962,480,808,1442,1026,577,1333,1105,910,1000,1160,1001,929,400,1241,403,812,700,450,621,441,1000,393,600,962,865,1154,1386,865,700,975,1300,900,829,827,1155,950,533,2004,890,3078,1539,1354,1143,962,1250,990,905,926,1559,1312,879,800,1049,550,1190,583,1200,797,1371,360,1270,1832,909,1746,520,808,692,931,812,866,1442,500,1384,528,1026,1212,1602,1000,1699,1699,1107,625,720,855,1250,1130,900,962,1573,940,900,882,1710,1260,751,1097,1154,1000,1250,857,1211,937,872,1261,950,115,673,1084,1058,800,855,864,1092,1025,673,800,1049,884,800,1200,664,1000,875,1202,666,923,788,866,680,693,2308,1196,700,721,1500,1050,1198,390,889,1076,1127,750,525,1104,553,800,1384,425,510,370,596,418,681,950,600,550,606,425,340,692,575,571,817,987,1026,808,808,788,850,900,1418,662,562,562,1009,1442,651,503,937,624,750,900,540,642,900,513,894,1282,485,325,769,618,1040,751,380,753,1065,1070,1573,650,700,891,1444,500,1473,803,962,600,450,629,1562,357,566,481,1442,645,477,664,1202],[12,18,14,12,11,10,15,12,18,15,16,16,10,15,11,16,12,16,16,16,13,18,17,18,14,13,18,17,14,13,16,18,12,17,13,18,17,16,13,12,18,12,16,18,16,12,17,12,17,12,12,12,12,18,16,18,16,12,16,16,12,15,12,12,11,15,10,13,13,12,15,12,12,17,16,12,15,16,16,18,12,12,12,10,17,12,16,12,12,12,13,12,13,12,12,13,12,12,14,12,12,13,18,16,12,18,16,12,12,12,12,12,12,12,10,10,18,17,11,18,12,11,16,17,12,13,16,12,15,16,14,15,16,16,16,18,17,12,13,14,12,12,12,12,12,12,13,16,12,14,12,12,12,16,13,12,12,16,14,12,12,16,18,17,12,12,12,12,12,15,12,13,17,13,16,13,18,13,12,12,12,12,16,16,16,14,16,12,16,16,18,18,18,18,15,12,14,12,14,12,14,12,12,12,12,10,17,16,16,18,16,12,12,16,14,14,18,14,12,16,18,14,16,13,16,16,14,13,13,12,12,16,12,12,12,10,16,17,12,15,16,15,14,12,16,12,14,14,12,12,12,13,12,16,16,12,16,12,12,12,12,12,12,11,10,18,13,16,12,16,14,15,12,13,9,16,14,12,16,17,12,12,12,14,14,16,18,11,11,12,12,12,17,12,16,18,13,12,12,15,12,12,13,12,14,12,14,13,12,13,12,12,13,14,12,14,12,16,18,12,12,12,17,14,16,18,15,16,15,16,12,18,11,12,16,12,12,12,12,12,12,14,12,16,13,12,16,16,13,11,11,15,16,12,16,13,12,12,16,12,12,12,12,9,14,16,12,12,16,11,12,11,12,9,14,18,12,16,16,12,14,12,16,13,13,12,13,11,12,15,17,12,12,16,11,12,16,12,12,12,12,12,12,16,12,13,14,14,12,12,14,10,11,11,16,16,15,12,12,13,17,12,18,12,12,17,16,12,13,12,11,18,16,12,12,15,13,16,12,12,18,16,16,12,16,12,16,12,11,12,10,12,12,12,12,18,16,11,18,14,12,13,16,16,15,12,12,12,16,17,16,14,13,14,12,13,12,16,12,12,15,15,16,12,16,16,15,13,18,12,12,12,16,15,12,16,12,17,12,10,17,16,14,12,18,13,16,17,15,16,14,12,12,12,13,12,13,12,10,10,10,12,12,17,12,12,12,11,16,16,13,12,9,13,14,12,16,13,15,12,18,14,13,17,17,12,12,12,12,12,12,12,10,18,13,14,12,17,14,14,16,18,13,12,12,12,18,16,16,15,16,16,14,12,14,18,18,12,12,16,13,12,12,12,11,13,12,12,18,12,15,12,14,16,12,18,12,12,11,15,12,12,12,12,16,15,17,12,12,17,15,14,12,12,12,16,16,12,14,16,17,16,17,12,12,12,16,12,16,12,12,12,12,17,14,12,12,13,15,16,12,12,12,12,15,13,12,12,12,13,17,11,12,12,12,12,11,10,12,11,10,14,12,12,9,16,12,16,12,17,12,12,12,12,14,13,12,16,12,11,11,12,10,12,14,10,13,10,16,18,18,12,12,12,14,12,12,12,10,16,12,18,10,12,12,15,12,16,13,16,16,11,12,17,14,16,12,16,12,12,16,13],[8,14,14,12,11,8,5,11,14,12,10,12,8,10,8,12,10,12,11,16,8,8,12,16,12,12,18,14,8,12,12,12,7,8,9,15,12,12,10,12,12,9,11,8,16,10,14,8,12,8,8,11,9,18,8,16,16,11,9,6,12,12,7,10,8,16,10,8,16,13,16,17,8,14,14,9,12,12,12,8,10,10,8,12,8,12,12,8,12,12,9,12,7,11,10,9,8,8,12,10,10,15,18,12,12,8,9,12,12,8,6,5,11,9,10,6,12,8,8,16,12,12,12,8,11,12,10,4,12,12,12,12,10,10,12,16,12,6,11,10,10,9,7,5,12,8,12,8,8,10,10,9,12,11,8,12,8,12,10,12,11,12,11,8,8,12,6,11,11,12,8,10,12,12,12,12,12,16,4,12,12,12,14,14,12,12,10,9,8,9,14,8,18,18,17,7,6,6,12,12,12,11,12,7,8,5,8,12,12,5,12,6,6,16,14,12,16,9,12,12,9,10,5,8,16,14,12,10,9,11,11,13,8,11,13,8,13,12,8,15,18,12,8,12,16,12,12,12,12,10,10,11,12,12,12,8,12,12,12,8,4,12,10,8,9,12,14,10,8,12,10,12,8,8,8,16,12,11,12,14,8,7,8,10,12,8,6,6,8,8,8,8,6,7,12,12,12,10,14,12,12,12,8,6,12,12,12,12,8,8,16,5,11,11,8,9,12,8,11,12,12,8,10,15,16,12,10,16,10,9,13,12,10,10,12,8,10,8,6,6,8,12,7,8,13,12,12,12,8,6,5,10,11,11,16,8,6,8,7,7,6,5,4,5,11,12,13,8,4,9,5,8,11,4,10,12,12,9,14,10,10,8,10,16,16,10,11,8,11,14,18,8,12,12,8,8,8,10,10,13,12,12,7,12,8,8,10,12,8,6,14,5,7,6,17,12,12,12,6,10,16,2,12,6,5,12,2,12,14,7,6,16,8,7,7,12,9,12,12,12,12,17,8,3,18,12,10,10,12,8,9,4,10,9,12,15,16,2,7,16,3,8,16,12,12,3,11,7,12,13,10,12,16,16,10,12,5,8,5,8,7,6,14,12,10,4,18,9,10,8,6,5,16,5,8,12,12,11,7,8,16,18,4,11,12,12,14,16,12,10,3,4,4,4,12,2,12,12,3,10,12,6,6,18,7,12,8,10,14,14,8,4,4,12,12,8,12,12,12,12,12,7,12,16,16,12,10,12,8,12,2,8,8,13,10,10,10,14,12,7,17,12,8,12,12,7,12,12,12,8,12,8,12,12,6,13,12,17,10,12,14,12,8,12,12,11,12,12,15,13,16,8,10,12,10,12,8,8,11,9,8,2,8,12,12,18,8,2,11,12,16,9,8,6,12,13,12,12,12,12,9,8,8,12,12,14,12,12,7,3,0,7,8,13,6,8,4,8,9,12,13,12,9,12,9,12,12,9,10,14,12,10,4,8,10,10,6,6,5,7,7,18,5,12,6,5,12,10,7,15,12,9,2,8,5,11,12,10,12,11,9,9,6,6,6,7,10,10,10,8,18,18,13,7,4,3,3,7,7,12,12,18,9,10,9,9,7,14,12,12,12,8,6,13,16,12,8,8,8,7,16,6],[8,14,14,12,6,8,14,12,13,12,10,12,6,12,10,12,10,12,11,16,12,8,13,16,12,12,18,17,12,15,13,12,8,12,10,14,12,12,12,12,12,12,12,11,17,12,12,6,12,12,12,9,12,12,8,12,12,11,12,12,12,14,7,12,8,12,14,12,16,12,16,16,8,12,12,10,9,9,9,8,9,8,9,9,8,12,12,10,10,12,12,12,8,12,12,12,12,9,12,12,12,16,16,12,12,9,10,12,12,12,7,2,14,6,7,8,12,12,8,16,8,12,13,12,9,12,12,11,12,12,12,14,12,10,8,12,12,11,12,11,10,12,7,11,7,12,12,8,11,8,10,9,8,9,12,12,12,12,8,9,12,11,11,16,10,10,12,12,12,12,8,12,13,13,12,12,8,16,8,16,10,10,12,12,11,12,10,11,8,11,12,12,16,14,12,12,8,12,14,12,12,12,8,8,9,8,12,12,12,9,12,8,12,16,10,12,10,11,8,10,12,12,8,11,16,16,12,8,8,5,5,17,8,11,11,11,12,11,12,12,16,12,8,12,16,12,14,12,12,12,8,10,12,14,14,8,13,12,13,5,16,12,12,9,11,12,11,12,10,12,8,11,8,8,8,13,12,12,16,12,12,8,8,12,14,12,8,9,8,8,10,8,12,11,12,16,12,12,12,15,12,12,13,8,8,6,12,12,8,15,12,8,11,12,11,8,12,2,12,12,12,12,12,12,16,12,12,12,12,12,12,9,10,10,12,10,9,8,6,6,12,12,12,12,12,12,12,12,12,12,10,11,10,12,13,14,7,12,12,9,4,6,8,11,12,12,10,12,12,8,7,8,12,7,9,12,11,12,8,12,12,10,11,13,12,14,8,8,12,12,12,8,8,12,12,8,9,12,12,11,9,9,8,12,12,12,12,11,8,12,16,12,12,12,16,11,12,9,6,12,12,6,8,12,12,8,8,12,12,8,6,12,8,12,12,14,7,8,12,12,12,12,8,8,18,11,12,11,12,8,9,9,9,6,12,15,12,11,12,13,8,8,16,12,11,3,11,12,16,16,12,12,12,16,12,12,12,11,8,12,10,7,12,12,12,12,12,6,10,7,7,9,12,11,6,12,12,12,7,12,12,17,8,10,17,12,16,13,12,11,9,1,3,3,12,6,12,12,8,6,12,8,8,17,8,9,10,0,16,4,8,8,5,12,12,8,16,12,12,11,12,7,12,12,16,12,10,12,8,12,0,8,12,13,12,12,12,12,12,6,14,16,12,12,8,12,12,12,12,8,12,12,12,12,11,12,12,14,12,12,8,12,12,11,12,11,12,12,18,13,12,11,12,12,8,12,9,10,12,12,12,6,8,16,16,12,6,8,10,16,16,15,7,7,12,13,10,12,10,10,14,12,8,12,8,14,12,12,12,10,6,6,12,12,10,2,12,12,16,12,16,9,12,14,12,10,10,8,10,13,14,2,3,2,9,9,10,5,5,3,3,8,7,8,8,0,12,14,8,15,12,12,3,8,5,12,12,12,9,10,9,12,10,10,10,10,4,12,12,9,12,12,10,7,7,7,8,7,12,11,14,14,12,10,12,11,12,12,10,12,12,8,10,12,13,12,12,8,7,7,16,8]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>wage<\/th>\n      <th>education<\/th>\n      <th>education_dad<\/th>\n      <th>education_mom<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":4,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[4,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
---

OLS for the returns to education with will likely (definitely) be biased...
$$
`\begin{align}
  \color{#FFA500}{\text{Wage}_i} = \beta_0 + \beta_1 \color{#6A5ACD}{\text{Education}}_i + u_i
\end{align}`
$$

--

.hi-slate[(Likely biased) OLS results:]
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:ols">
<col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">term</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">estimate</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">std.error</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">statistic</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">p.value</th></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">(Intercept)</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">177&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">89.2&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.98</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.0481&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">education</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">58.6</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">6.44</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">9.1&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">8.76e-19</td></tr>
</table>


--

but what if mother's education provides a valid instrument?
---

We can check/test the *relevance* of .hi-pink[mother's education] for .hi-purple[education].

--

This regression is known as the .hi-slate[*first stage*:]
&lt;br&gt; The effect of the .pink[instrument] on our .purple[endogenous explanatory variable].

$$
`\begin{align}
  \color{#6A5ACD}{\text{Education}_i} = \gamma_0 + \gamma_1 \color{#e64173}{\left( \text{Mother's Education} \right)_i} + v_i
\end{align}`
$$

---

We can check/test the *relevance* of .hi-pink[mother's education] for .hi-purple[education].

.hi-slate[First-stage results:]
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:first_stage">
<col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">term</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">estimate</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">std.error</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">statistic</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">p.value</th></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">(Intercept)</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">10.5&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.306&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">34.3</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.13e-153</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">education_mom</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.294</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.0274</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">10.7</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">4.41e-25&nbsp;</td></tr>
</table>

--

The *p*-value suggests a very strong relationship (very *relevant*).
---
layout: false

# Instrumental variables
## Visualizing the first stage

&lt;img src="IV_files/figure-html/first_stage_plot-1.svg" style="display: block; margin: auto;" /&gt;
---
count: false

# Instrumental variables
## Visualizing the first stage

&lt;img src="IV_files/figure-html/first_stage_plot2-1.svg" style="display: block; margin: auto;" /&gt;
---
# Instrumental variables
## Exogeneity

**Q:** What does .hi[exogeneity] mean in this case?
--
&lt;br&gt;**A:** We need two things

1. .pink[Mother's education (our instrument)] must only affect earnings through .purple[education (our endogenous explanatory variable)].
2. .pink[Mother's education] must be uncorrelated with other factors that affect .orange[wages (our outcome variable)].

--

We want to be able to compare two people (*A* and *B*) whose mothers have different levels of education and say that the only differences between the two people (*A* and *B*) are due to their mothers' educational levels.

--

**Q:** Does *mother's education* seem likely to satisfy exogeneity?
---
layout: true
# Instrumental variables
## Example in .mono[R]
---

Now, let's estimate the .hi-turquoise[*reduced form*]:
&lt;br&gt; The effect of the .pink[instrument] on our .orange[outcome variable].

$$
`\begin{align}
  \color{#FFA500}{\text{Wage}_i} = \pi_0 + \pi_1 \color{#e64173}{\left( \text{Mother's Education} \right)_i} + w_i
\end{align}`
$$

--

.hi-turquoise[Reduced-form results:]
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:reduced_form">
<col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">term</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">estimate</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">std.error</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">statistic</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">p.value</th></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">(Intercept)</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">633&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">58.6&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">10.8&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">2.37e-25</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">education_mom</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">31.8</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">5.24</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">6.07</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2.12e-09</td></tr>
</table>


--

**Q.sub[1]:** How do we interpret this estimated coefficient `\(\left( \hat{\pi}_1 \right)\)`?
--
&lt;br&gt;**Q.sub[2]:** If our instrument is *valid*, can we interpret these estimates as .hi[causal]?
---

So what is our IV-based estimate for the returns to education?
$$
`\begin{align}
  \color{#FFA500}{\text{Wage}_i} = \beta_0 + \beta_1 \color{#6A5ACD}{\text{Education}}_i + u_i
\end{align}`
$$

--

We know that the IV estimate for `\(\beta_1\)` is

$$
`\begin{align}
  \hat{\beta}_1^\text{IV} = \dfrac{\color{#20B2AA}{\hat{\pi}_1}}{\color{#314f4f}{\hat{\gamma}_1}}
\end{align}`
$$

--

1. In the .hi-turquoise[reduced-form equation], we estimated `\(\color{#20B2AA}{\hat{\pi}_1 \approx 31.81}\)`.
2. In the .hi-slate[first-stage equation], we estimated `\(\color{#314f4f}{\hat{\gamma}_1 \approx 0.294}\)`.

--

$$
`\begin{align}
  \implies\hat{\beta}_1^\text{IV} = \dfrac{\color{#20B2AA}{\hat{\pi}_1}}{\color{#314f4f}{\hat{\gamma}_1}} = \dfrac{\color{#20B2AA}{31.81}}{\color{#314f4f}{0.294}} \approx 108.2
\end{align}`
$$
---

**Alternative:** Use the function `iv_robust()` from the `estimatr` package.

This new function `iv_robust` works very similar to our good friend `lm`:

`iv_robust(y ~ x | z, data = dataset)`

- `formula` Specify the regression followed by `|` and your instrument (`z`).
- `data` You still need a dataset.

***Note:*** As you might guess by its name, `iv_robust` calculates heteroskedasticity-robust standard errors by default.

---

In practice...


```r
# Estimate our IV regression
iv_est &lt;- iv_robust(wage ~ education | education_mom, data = wage_df)
```

<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:iv_reg_results">
<col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">term</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">estimate</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">std.error</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">statistic</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">p.value</th></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">(Intercept)</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-501</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">226&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-2.21</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.0271&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">education</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">108</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">16.8</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">6.44</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2.22e-10</td></tr>
</table>

---
layout: true
# Instrumental variables
## More
---

So now we know how to "do" instrumental variables
--
 *when we have one endogenous variable and one exogenous variable.*

--

1. Estimate the reduced form (regress .orange[outcome var.] on .pink[instrument]).
2. Estimate the first stage (regress .purple[expl. var.] on .pink[instrument]).
3. Calculate the IV estimate using the estimates from (1) and (2).

Our magical .pink[instrument] isolates the exogenous variation in our .purple[endogenous variable].

--

**Q:** What if we want more?
--
 (_E.g._, more instruments or endog. variables)
--
&lt;br&gt;**A:** Too bad.
---
count: false

So now we know how to "do" instrumental variables *when we have one endogenous variable and one exogenous variable.*

1. Estimate the reduced form (regress .orange[outcome var.] on .pink[instrument]).
2. Estimate the first stage (regress .purple[expl. var.] on .pink[instrument]).
3. Calculate the IV estimate using the estimates from (1) and (2).

Our magical .pink[instrument] isolates the exogenous variation in our .purple[endogenous variable].

**Q:** What if we want more? (_E.g._, more instruments or endog. variables)
&lt;br&gt;**A:** .st[Too bad.] Extend IV to .hi[two-stage least squares (2SLS)].
---
layout: false
class: inverse, middle
# Two-stage least squares
---
layout: true
# Two-stage least squares
## Intro
---
name: 2sls_intro

The intuition and insights of IV carry over into two-stage least squares.

--

**Plus:** The *first stage* that we've been discussing is actually the *first* of the *two stages* in two-stage least squares.

--

$$
`\begin{align}
  {\color{#c5c5c5}{\text{Endogenous model}}}&amp; &amp;\color{#FFA500}{\text{Outcome}_i} &amp;= \beta_0 + \beta_1 \color{#6A5ACD}{\left( \text{Endog. var.} \right)_i} + u_i\\[0.5em]
  {\text{First stage}}&amp; &amp;\color{#6A5ACD}{\left( \text{Endog. var.} \right)_i} &amp;= \pi_0 + \pi_1 \color{#e64173}{\text{Instrument}_i} + v_i\\[0.25em]
  {\text{Second stage}}&amp; &amp;\color{#FFA500}{\text{Outcome}_i} &amp;= \delta_0 + \delta_1 \color{#6A5ACD}{\widehat{\left( \text{Endog. var.} \right)}_i} + \varepsilon_i\\[0.5em]
  {\color{#c5c5c5}{\text{Reduced form}}}&amp; &amp;\color{#FFA500}{\text{Outcome}_i} &amp;= \pi_0 + \pi_1 \color{#e64173}{\text{Instrument}_i} + w_i\\[0.25em]
\end{align}`
$$

where `\(\color{#6A5ACD}{\widehat{\left( \text{Endog. var.} \right)}_i}\)` denotes the predicted values (*fitted values*) from the first-stage regression.
---

Two-stage least squares is very flexible—we include other controls, additional endogenous variables, *and* have multiple instruments.

**But** don't get too distracted by this fancy flexiblity.

We still need .hi[valid] instruments.
---
layout: true
# Two-stage least squares
## In .mono[R]
---
name: 2sls_r

Back to our *returns to education* example.

$$
`\begin{align}
  \color{#FFA500}{\text{Wage}_i} = \beta_0 + \beta_1 \color{#6A5ACD}{\text{Education}}_i + u_i
\end{align}`
$$

Imagine that mother's *and* father's education are both valid instruments.

Then our .hi-slate[first-stage regression] is
$$
`\begin{align}
  \color{#6A5ACD}{\text{Education}}_i = \gamma_0 + \gamma_1 \color{#e64173}{\left( \text{Mother's education} \right)}_i + \gamma_2 \color{#e64173}{\left( \text{Father's education} \right)}_i + v_i
\end{align}`
$$
which we can estimate via OLS.

--

**Q:** Why?
---

$$
`\begin{align}
  \color{#6A5ACD}{\text{Education}}_i = \gamma_0 + \gamma_1 \color{#e64173}{\left( \text{Mother's education} \right)}_i + \gamma_2 \color{#e64173}{\left( \text{Father's education} \right)}_i + v_i
\end{align}`
$$


```r
stage1 &lt;- lm(education ~ education_mom + education_dad, wage_df)
```

.hi-slate[First-stage results:]
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:stage1_table">
<col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">term</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">estimate</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">std.error</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">statistic</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">p.value</th></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">(Intercept)</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">9.85&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.305&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">32.3&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">3.59e-142</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">education_mom</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.149</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.0322</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">4.62</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">4.47e-06&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">education_dad</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.216</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.0275</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">7.84</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.67e-14&nbsp;</td></tr>
</table>


--

Our instruments each appear to be *relevant*.
--
 Formally, we want an `\(F\)` test.
---

Using our .slate[estimated first stage], we grab the *fitted* .purple[endogenous variable]
$$
`\begin{align}
  \color{#6A5ACD}{\widehat{\text{Education}}}_i = \widehat{\gamma}_0 + \widehat{\gamma}_1 \color{#e64173}{\left( \text{Mother's education} \right)}_i + \widehat{\gamma}_2 \color{#e64173}{\left( \text{Father's education} \right)}_i
\end{align}`
$$

--


```r
# Add fitted values from first stage
wage_df$education_hat &lt;- stage1$fitted.values
```

--

Now we use OLS (again) to estimate the .hi-green[second-stage regression]
$$
`\begin{align}
  \color{#FFA500}{\text{Wage}_i} = \delta_0 + \delta_1 \color{#6A5ACD}{\widehat{\text{Education}}}_i + \varepsilon_i
\end{align}`
$$
---

$$
`\begin{align}
  \color{#FFA500}{\text{Wage}_i} = \delta_0 + \delta_1 \color{#6A5ACD}{\widehat{\text{Education}}}_i + \varepsilon_i
\end{align}`
$$


```r
stage2 &lt;- lm(wage ~ education_hat, wage_df)
```

.hi-green[Second-stage results:]
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:stage2_table">
<col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">term</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">estimate</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">std.error</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">statistic</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">p.value</th></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">(Intercept)</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-455</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">198&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-2.29</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.022&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">education_hat</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">105</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">14.5</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">7.25</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1.11e-12</td></tr>
</table>

---
layout: false
class: clear

.purple[Ordinary least squares]
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:results_ols">
<col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">term</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">estimate</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">std.error</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">statistic</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">p.value</th></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">(Intercept)</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">177&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">89.2&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.98</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.0481&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">education</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">58.6</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">6.44</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">9.1&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">8.76e-19</td></tr>
</table>

&lt;br&gt;.slate[Instrumental variables]
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:results_iv">
<col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">term</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">estimate</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">std.error</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">statistic</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">p.value</th></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">(Intercept)</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-501</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">226&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-2.21</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.0271&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">education</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">108</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">16.8</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">6.44</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2.22e-10</td></tr>
</table>

&lt;br&gt;.green[Two-stage least squares w/ two instruments]
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:results_2sls">
<col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">term</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">estimate</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">std.error</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">statistic</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">p.value</th></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">(Intercept)</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-455</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">198&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-2.29</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.022&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">education_hat</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">105</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">14.5</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">7.25</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1.11e-12</td></tr>
</table>

---
layout: false

# Two-stage least squares
## In .mono[R]

As you probably guessed, .mono[R] will do both of the stages for you.

--

`iv_robust(y ~ x1 + x2 + ⋯ | z1 + z2 + ⋯, data)`

--

In our case, we have
- one explanatory variable (`x`) (.purple[education])
- two instruments (`z`) (.pink[parents' educations])

Let's see how to do this in .mono[R]

---


```r
iv_robust(wage ~ education | education_mom + education_dad, data = wage_df)
```

<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:iv_robus_2sls_table">
<col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">term</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">estimate</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">std.error</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">statistic</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">p.value</th></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">(Intercept)</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-455</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">200&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-2.27</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.0233&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">education</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">105</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">14.9</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">7.06</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">4.05e-12</td></tr>
</table>

---
name: more

# Two-stage least squares
## There's more!

Because 2SLS .hi[isolates exogenous variation in an endogenous variable], we apply it in other settings that are biased from *endogenous* relationships.

--

.hi[Common applications]

- **General causal inference** for observational data (as we've seen).
- **Experiments:** Randomize a treatment that affects an endog. variable.
- **Measurement error:** Regress noisy `\(x_1\)` on noisy `\(x_2\)` to capture signal.
- **Simultaneous relationships** (_e.g._, `\(p\)` and `\(q\)` from supply and demand).

However, in any 2SLS/IV setting, you need to mind the requirements for .hi[valid instruments]—.pink[exogeneity] and .pink[relevance].

---
layout: false
# Table of contents

.pull-left[
### Admin
.smallest[

1. [Schedule](#schedule)
1. [Causality review](#causality_review)
]
]

.pull-right[
### Instrumental variables
.smallest[

1. [Introduction](#intro)
1. [What is an instrument?](#instruments)
  - [Relevant](#relevant)
  - [Exogenous](#exogenous)
1. [IV Estimation](#iv_estimation)
1. [Venn diagrams](#venn)
1. [Example in .mono[R]](#r_example)
1. [Two-stage least squares](#2sls_intro)
  - [Introduction](#2sls_intro)
  - [Back to .mono[R]](#2sls_r)
1. [More applications](#more)
]
]

---

exclude: true



    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
